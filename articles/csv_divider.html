<span class = "content_title"> <a href="#/windows"> Windows</a> / <span class = "content_title_current">CSV Divider and something about chars representation</span> </span>
<hr/>
<br/>

<div>
&emsp;The main inspiration for writing this code was the MS Excel row limit which is exactly 1,048,576 and I had to deal from time to time with larger data sets.<br/>
When writing the lines, I came along two issues, first, no new line chars - when using <span class="code_quote">getline()</span> we get the line without line ending character (in Windows CRLF - carriage return and line feed, in hex 0x0D0A or just \n char) so we need to add it and that could be the final solution for most of the files. The second issue, a little bit harder, was the file encoding, of course it wasn't normal CSV file but just large txt report, however the tool couldn't handle.
Normally created txt files contain 8-bit characters in UTF-8 manner and operating on them is not persistent, but what if we bump into UTF-16 files? It's recommended to read first about <a class="external_link" target="_blank" href="https://en.wikipedia.org/wiki/Byte_order_mark" >BOM (Byte Order Mark)</a> and <a class="external_link" target="_blank" href="https://en.wikipedia.org/wiki/Endianness" >endianess</a>.<br/>

&emsp;Attempts to put line ending in standard text mode so <span class="quote">0D 0A</span>, no matter if I did this by using <span class="code_quote">"\n"</span> or <span class="code_quote">std::endl</span> or <span class="code_quote">.write("\n")</span> fstream method, it always ended with this hex sequence for UTF-16 LE file: <span class="quote">0D 00 0D 0A</span>.<br/>

It means that <span class="code_quote">getline()</span> takes just <span class="quote">0A</span> as line end and in case of UTF-16 LE leaving behind <span class="quote">0D 00</span>, because it expects normally <span class="quote">0D 0A</span>.<br/>
<span class="quote">0A</span> so just LF is the correct line ending on Linux and Mac systems. Therefore if we have every line left with such ending, finally to <span class="quote">0D 00</span> we get <span class="quote">0D 0A</span> added which is correct line ending on Windows, leading finally to <span class="quote">0D 00 0D 0A</span>.<br/>
&emsp;C++ have some higher levels ways to handle, but I've decided to solve this on byte level. Mentioned before 
<span class="code_quote">.write()</span> method could be applied partially successfully in binary mode by adding just <span class="quote">0x0A</span> buffer, however in case of LE files we would have following zero char moved (or chars in case of UTF32) to the beginning of the next part. I omitted then <span class="quote">getline()</span> and did everything on my own to be sure about the final data inside the files.</br>
&emsp;When operating in binary mode it's important how we read the file, because e.g. <span class="quote">getline()</span> method in while loop is going to reach EOF (end of file) flag and stream position changes to -1. Same will happen when reading the buffer in binary mode with <span class="quote">read()</span> fstream method beyond the size of the file, in the end it would add unnecessary work for calculations so in my program I'm reading exact number of remaining bytes if the number is lower than the buffer size in consequence never reaching EOF, but I keep the <span class="code_quote">buffer_feed</span> what is important when writing data to the final outfile part to not write any redundant bytes.<br/>
I had to discover this dependency when moving back with offset in <span class="code_quote">infile</span> and rereading data was not working correctly in <span class="code_quote">if (line_end_count == max_lines)</span> part.

<br/><br/>
<button id="changeCodeHeightBtn_id_1" onclick="change_code_height('1')" style="float:right; width:100px;">100% height</button>
<br/>

<div id="code_id_1" class = "code_long"><span class="sc9">#include &lt;iostream&gt;
#include &lt;fstream&gt;
#include &lt;string&gt;
#include &lt;filesystem&gt;
</span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ifstream</span><span class="sc0"> </span><span class="sc11">infile</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ofstream</span><span class="sc0"> </span><span class="sc11">outfile</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">enum</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">UTF8</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">UTF8BOM</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">UTF16LE</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">UTF16BE</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">UTF32LE</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">UTF32BE</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_string_num</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">max_line_s</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">!</span><span class="sc11">max_line_s</span><span class="sc10">.</span><span class="sc11">empty</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">max_line_s</span><span class="sc10">.</span><span class="sc11">find_first_not_of</span><span class="sc10">(</span><span class="sc6">"0123456789"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc10">::</span><span class="sc11">npos</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">outfile_is_good</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ofstream</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">outfile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">save_path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">outfile_part</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">extension</span><span class="sc10">){</span><span class="sc0">

    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">good</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Error occured when trying to open the file. Please try again, provide the source path or enter 'q' to exit the program.\n"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">getline</span><span class="sc10">(</span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">save_path</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"q"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">save_path</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'"'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">[</span><span class="sc11">save_path</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'"'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">.</span><span class="sc11">substr</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">save_path</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"\\\\?\\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">open</span><span class="sc10">(</span><span class="sc11">save_path</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"_part"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">to_string</span><span class="sc10">(</span><span class="sc11">outfile_part</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"."</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">extension</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">app</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">binary</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">main</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"This program divides text files into parts containing requested number of lines,\n"</span><span class="sc0">
        </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"(for MS Excel max limit please enter 1048576).\n"</span><span class="sc0">
        </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"It detects UTF - 8, UTF - 16 LE / BE, UTF - 32 LE / BE encoding by BOM detection,\n"</span><span class="sc0">
        </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"in case of missing BOM it treats the file as UTF8 no BOM.\n"</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Please provide source path : \n"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">src_path</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">getline</span><span class="sc10">(</span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">src_path</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">src_path</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'"'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">src_path</span><span class="sc10">[</span><span class="sc11">src_path</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'"'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">src_path</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">src_path</span><span class="sc10">.</span><span class="sc11">substr</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">src_path</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">src_path</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"\\\\?\\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">src_path</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">filesystem</span><span class="sc10">::</span><span class="sc11">exists</span><span class="sc10">(</span><span class="sc11">src_path</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
       </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Provided file doesn't exist! Please try again or enter 'q' to exit the program.\n"</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">getline</span><span class="sc10">(</span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">src_path</span><span class="sc10">);</span><span class="sc0">
       </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">src_path</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"q"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">open</span><span class="sc10">(</span><span class="sc11">src_path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">binary</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">is_open</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Couldn't open the file, check if some other program is not blocking it and/or if you have rights to this file.\n"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">outfile_part</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Provide save path including files basename: \n"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">getline</span><span class="sc10">(</span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Provide destination files extension: \n"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">extension</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">getline</span><span class="sc10">(</span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">extension</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">save_path</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'"'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">[</span><span class="sc11">save_path</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'"'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">.</span><span class="sc11">substr</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">save_path</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"\\\\?\\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">open</span><span class="sc10">(</span><span class="sc11">save_path</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"_part"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">to_string</span><span class="sc10">(</span><span class="sc11">outfile_part</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"."</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">extension</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">app</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">binary</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">outfile_is_good</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">outfile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">outfile_part</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">extension</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"How many lines should be saved in one file?:\n"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">max_lines_s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">getline</span><span class="sc10">(</span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">max_lines_s</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">is_string_num</span><span class="sc10">(</span><span class="sc11">max_lines_s</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"It's not a number, please try again or enter 'q' to exit the program.\n"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">getline</span><span class="sc10">(</span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">max_lines_s</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">max_lines_s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"q"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">max_lines</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">stoull</span><span class="sc10">(</span><span class="sc11">max_lines_s</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">short</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">buffer_size</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc4">8192</span><span class="sc0"> </span><span class="sc10">};</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buffer</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc11">buffer_size</span><span class="sc10">]{</span><span class="sc7">'\0'</span><span class="sc10">};</span><span class="sc0">
    </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc16">size_t</span><span class="sc0"> </span><span class="sc11">infile_size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">tellg</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">beg</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">infile_size</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"File is too small to operate on, under 4 bytes, really? Exiting.\n"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">  
    </span><span class="sc11">encoding</span><span class="sc0"> </span><span class="sc11">infile_encoding</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF8</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0xEF</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0xBB</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0xBF</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">infile_encoding</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF8BOM</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Detected UTF-8 BOM.\n"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">beg</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0xFF</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0xFE</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc4">0x00</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">infile_encoding</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF16LE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Detected UTF-16 LE BOM.\n"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">beg</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0xFE</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0xFF</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">infile_encoding</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF16BE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Detected UTF-16 BE BOM.\n"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">beg</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0xFF</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0xFE</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0x00</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">3</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0x00</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">infile_encoding</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF32LE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Detected UTF-32 LE BOM.\n"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(</span><span class="sc4">4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">beg</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0x00</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0x00</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0xFE</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">3</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0xFF</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">infile_encoding</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF32BE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Detected UTF-32 BE BOM.\n"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(</span><span class="sc4">4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">beg</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">beg</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"No BOM recognized, proceeding with UTF-8 no BOM encoding.\n"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">short</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">buffer_feed</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">};</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">infile_size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">tellg</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">buffer_size</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">infile_size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">tellg</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">infile_size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">tellg</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">infile_size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">tellg</span><span class="sc10">());</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">infile_size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">tellg</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">2048</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">buffer_size</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buffer_size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">line_end_count</span><span class="sc10">{};</span><span class="sc0">

    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">short</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">{};</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">buffer_feed</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0x0A</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">line_end_count</span><span class="sc10">++;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">line_end_count</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">max_lines</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

                </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">infile_encoding</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF8</span><span class="sc10">:</span><span class="sc0">
                    </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(-(</span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">cur</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF8BOM</span><span class="sc10">:</span><span class="sc0">
                    </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(-(</span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">cur</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF16LE</span><span class="sc10">:</span><span class="sc0">
                    </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(-(</span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">cur</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF16BE</span><span class="sc10">:</span><span class="sc0">
                    </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(-(</span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">cur</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF32LE</span><span class="sc10">:</span><span class="sc0">
                    </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(-(</span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">cur</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF32BE</span><span class="sc10">:</span><span class="sc0">
                    </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">seekg</span><span class="sc10">(-(</span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">cur</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">

                </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">close</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">line_end_count</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">   
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">buffer_feed</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buffer_feed</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
     
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">infile_size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">tellg</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">buffer_size</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">infile_size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">tellg</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">infile_size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">tellg</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">infile_size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">tellg</span><span class="sc10">());</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">infile_size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">tellg</span><span class="sc10">()&gt;=</span><span class="sc4">2048</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">buffer_size</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buffer_size</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer_feed</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">!</span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">is_open</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">outfile_part</span><span class="sc10">++;</span><span class="sc0">
            </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">open</span><span class="sc10">(</span><span class="sc11">save_path</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"_part"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">to_string</span><span class="sc10">(</span><span class="sc11">outfile_part</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"."</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">extension</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">app</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">binary</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">good</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">outfile_is_good</span><span class="sc10">(</span><span class="sc11">outfile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">save_path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">outfile_part</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">extension</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">infile_encoding</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF8BOM</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">UTF8BOM</span><span class="sc10">[]{</span><span class="sc0"> </span><span class="sc4">0xEF</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xBB</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xBF</span><span class="sc0"> </span><span class="sc10">};</span><span class="sc0">
                </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">UTF8BOM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF16LE</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">UTF16LE</span><span class="sc10">[]{</span><span class="sc0"> </span><span class="sc4">0xFF</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xFE</span><span class="sc0"> </span><span class="sc10">};</span><span class="sc0">
                </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">UTF16LE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF16BE</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">UTF16BE</span><span class="sc10">[]{</span><span class="sc0"> </span><span class="sc4">0xFE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xFF</span><span class="sc0"> </span><span class="sc10">};</span><span class="sc0">
                </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">UTF16BE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF32LE</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">UTF32LE</span><span class="sc10">[]{</span><span class="sc0"> </span><span class="sc4">0xFF</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xFE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x00</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x00</span><span class="sc0"> </span><span class="sc10">};</span><span class="sc0">
                </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">UTF32LE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc10">::</span><span class="sc11">UTF32BE</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">UTF32BE</span><span class="sc10">[]{</span><span class="sc0"> </span><span class="sc4">0x00</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x00</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xFE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xFF</span><span class="sc0"> </span><span class="sc10">};</span><span class="sc0">
                </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">UTF32BE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">infile</span><span class="sc10">.</span><span class="sc11">close</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">is_open</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">outfile</span><span class="sc10">.</span><span class="sc11">close</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Program finished. Number of parts: "</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">outfile_part</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"\n"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">system</span><span class="sc10">(</span><span class="sc6">"pause"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span></div>


</div>
