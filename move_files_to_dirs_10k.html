<span class = "content_title"> <a href="#/cpp"> C++</a> / <span class = "content_title_current">Move large amount of files into subfolders with 10k limit using C++ </span> </span>
<hr/>
<br/>

<div>
&emsp;Maximum limit of files inside single folder for NTFS filesystem is 4,294,967,295 but it doesn't necessary provides comfort files browsing. Once I received several hundred thousand files in a single folder it wasn't fun to scroll up and down and work with those files, also I needed to create some report and deliver everything to the customer later. Maybe with a faster machine it would be better, but I couldn't be sure about it. Quick C++ solution to move the files into the subfolders with maximum limit of 10k files was the right choice.

<div class = "code_long"><span class="sc9">#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;filesystem&gt;
</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">fs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">filesystem</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">main</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">sourcePath</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"\n***MoveFilesToDirs10K***\n\nProvide source path:\n"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">getline</span><span class="sc10">(</span><span class="sc11">cin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sourcePath</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sourcePath</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'"'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">sourcePath</span><span class="sc10">[</span><span class="sc11">sourcePath</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'"'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">sourcePath</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sourcePath</span><span class="sc10">.</span><span class="sc11">substr</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sourcePath</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">sourcePath</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"\\\\?\\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sourcePath</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">baseTargetPath</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"\nProvide target path:\n"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">getline</span><span class="sc10">(</span><span class="sc11">cin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">baseTargetPath</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">baseTargetPath</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'"'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">baseTargetPath</span><span class="sc10">[</span><span class="sc11">baseTargetPath</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'"'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">baseTargetPath</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">baseTargetPath</span><span class="sc10">.</span><span class="sc11">substr</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">baseTargetPath</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">targetPath</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"\\\\?\\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">baseTargetPath</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\\1\\"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">u16string</span><span class="sc0"> </span><span class="sc11">u16targetPath</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">targetPath</span><span class="sc10">.</span><span class="sc11">begin</span><span class="sc10">(),</span><span class="sc11">targetPath</span><span class="sc10">.</span><span class="sc11">end</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">};</span><span class="sc0">
    </span><span class="sc11">fs</span><span class="sc10">::</span><span class="sc11">create_directory</span><span class="sc10">(</span><span class="sc11">u16targetPath</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc16">auto</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">now</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">chrono</span><span class="sc10">::</span><span class="sc11">system_clock</span><span class="sc10">::</span><span class="sc11">now</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc16">time_t</span><span class="sc0"> </span><span class="sc11">newt</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">chrono</span><span class="sc10">::</span><span class="sc11">system_clock</span><span class="sc10">::</span><span class="sc11">to_time_t</span><span class="sc10">(</span><span class="sc11">now</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">timeBuf</span><span class="sc10">[</span><span class="sc4">26</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">ctime_s</span><span class="sc10">(</span><span class="sc11">timeBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">26</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">newt</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"\nStarted: "</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">timeBuf</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"\nPlease use Task Manager to monitor the process..\n\n"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">u16string</span><span class="sc0"> </span><span class="sc11">filename</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">counter</span><span class="sc10">{};</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">folderNum</span><span class="sc10">{</span><span class="sc4">2</span><span class="sc10">};</span><span class="sc0">

    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">auto</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">entry</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">fs</span><span class="sc10">::</span><span class="sc11">recursive_directory_iterator</span><span class="sc10">(</span><span class="sc11">sourcePath</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">counter</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">10000</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">targetPath</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"\\\\?\\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">baseTargetPath</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">to_string</span><span class="sc10">(</span><span class="sc11">folderNum</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\\"</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">u16targetPath</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">u16string</span><span class="sc10">(</span><span class="sc11">targetPath</span><span class="sc10">.</span><span class="sc11">begin</span><span class="sc10">(),</span><span class="sc11">targetPath</span><span class="sc10">.</span><span class="sc11">end</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">fs</span><span class="sc10">::</span><span class="sc11">create_directory</span><span class="sc10">(</span><span class="sc11">u16targetPath</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">folderNum</span><span class="sc10">++;</span><span class="sc0">
            </span><span class="sc11">counter</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc11">filename</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">entry</span><span class="sc10">.</span><span class="sc11">path</span><span class="sc10">().</span><span class="sc11">filename</span><span class="sc10">().</span><span class="sc11">u16string</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc11">u16string</span><span class="sc0"> </span><span class="sc11">tempTarget</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">u16targetPath</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">filename</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">fs</span><span class="sc10">::</span><span class="sc11">rename</span><span class="sc10">(</span><span class="sc11">entry</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tempTarget</span><span class="sc10">);</span><span class="sc0">    

    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">newt</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">chrono</span><span class="sc10">::</span><span class="sc11">system_clock</span><span class="sc10">::</span><span class="sc11">to_time_t</span><span class="sc10">(</span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">chrono</span><span class="sc10">::</span><span class="sc11">system_clock</span><span class="sc10">::</span><span class="sc11">now</span><span class="sc10">());</span><span class="sc0">
    </span><span class="sc11">ctime_s</span><span class="sc10">(</span><span class="sc11">timeBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">26</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">newt</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Process completed!\n\nFinished at: "</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">timeBuf</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"\n\n"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">system</span><span class="sc10">(</span><span class="sc6">"pause"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span>
</div>


</div>
