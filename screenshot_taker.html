<span class = "content_title"> <a href="#/windows"> Windows</a> / <span class = "content_title_current">Screenshot Taker</span> </span>
<hr/>
<br/>

<div>
&emsp;In this article I would like to present the code that can capture screen image and save it to a file when using basic bitmap handling on Windows OS and offered <a class="external_link" target="_blank" href="https://learn.microsoft.com/en-us/windows/win32/gdi/windows-gdi" >GDI (Graphics Device Interface)</a>.<br/>
<a class="external_link" target="_blank" href="https://en.wikipedia.org/wiki/BMP_file_format" >BMP</a> is an image file format storing digital raster graphics independently of the display device <a class="external_link" target="_blank" href="https://learn.microsoft.com/en-us/windows/win32/gdi/device-independent-bitmaps" >(DIB - Device Independent Bitmap)</a>. We are going to focus on standard, uncompressed format which is actually basic method for storing graphics. It contains file and info header including basic informations about the file followed by actual bitmap (pixel array) containing color data for every pixel. Simple as that!<br/>
Most of the definitions are copied from the <a class="external_link" target="_blank" href="https://learn.microsoft.com" >MS website</a>.<br/><br/>

Basic data types and functions associated with the topic:<br/>
<span class="code_quote">HWND </span> - A handle to a window. This type is declared in WinDef.h as follows:
<span class="code_quote">typedef HANDLE HWND;</span><br/>
<span class="code_quote">HDC </span> - A handle to a device context (DC). This type is declared in WinDef.h as follows:
<span class="code_quote">typedef HANDLE HDC;</span><br/>
<span class="code_quote">HBITMAP </span> - A handle to a bitmap. This type is declared in WinDef.h as follows:
<span class="code_quote">typedef HANDLE HBITMAP;</span><br/>
<span class="code_quote">BITMAP </span> - The BITMAP structure defines the type (must be 0), width, height, color format, and most important, a pointer to the bit values of a bitmap (pixel array), that are stored in char (1 Byte) array.<br/>
<span class="code_quote">BITMAPFILEHEADER </span> - Contains 2 bytes, "BM" (it's a must) signature at offset 0, size of the file in bytes and offset to the actual data (pixel array).<br/>
<span class="code_quote">BITMAPINFOHEADER </span> - Contains basic informations about bitmap including its width, height, planes (must be 1), BPP (bits per pixel) so color depth, compression (BI_RGB in our case meaning uncompressed RGB) and others.<br/>
<span class="code_quote">DWORD </span> - 32 bits/4 bytes of data. It's important for bitmap as bits defining pixel array build rows (scan lines) and the size of each row is rounded up to a multiple of 4 bytes (ein 32-bit DWORD) by padding.<br/>
<span class="code_quote">GetSystemMetrics(SM_CXSCREEN) /  GetSystemMetrics(SM_CYSCREEN)</span> - Obtaining the width and height in pixels of the screen of the primary display monitor.<br/>
<span class="code_quote">GetDesktopWindow()</span> - Returns a handle to the desktop window.<br/>
<span class="code_quote">GetDC()</span> - Returns a handle to the DC of the specified window. <span style="text-decoration:underline">If this value is NULL, GetDC retrieves the DC for the entire screen.</span> It means we could pass NULL instead of HWND object to get capture from all the screens.<br/>
<span class="code_quote">CreateCompatibleDC()</span> - Function creates a memory device context (DC) compatible with the specified device, if it succeeds the return value is the handle to a memory DC.<br/>
<span class="code_quote">CreateCompatibleBitmap()</span> - Function creates a bitmap compatible with the device that is associated with the specified device context, if it succeeds the return value is the handle to it. It just initializes bitmap with default values, such saved object would be completely black.<br/>
<span class="code_quote">SelectObject()</span> - Function selects an object into the specified device context (DC). The new object replaces the previous object of the same type.<br/>
<div class = "code_short"><span class="sc11">HGDIOBJ</span><span class="sc0"> </span><span class="sc11">SelectObject</span><span class="sc10">(</span><span class="sc0">
  </span><span class="sc10">[</span><span class="sc11">in</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc11">HDC</span><span class="sc0"> </span><span class="sc11">hdc</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc10">[</span><span class="sc11">in</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc11">HGDIOBJ</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc0">
</span><span class="sc10">);</span>
</div>
&emsp;In the code we do not pass literally HGDIOBJ but HBITMAP so handle to the BITMAP which actually is GDI object.
<br/>
<span class="code_quote">BitBlt()</span> - Function executes a bit-block transfer of the color data corresponding to a rectangle of pixels from the specified source device context into a destination device context.<br/>
<span class="code_quote">GetObjectW()</span> - Function gets information for the specified graphics object so our bitmap in this case.<br/>
<span class="code_quote">GetDIBits()</span> - Function retrieves the bits of the specified compatible bitmap and copies them into a buffer as a DIB using the specified format.<br/>

<br/>
<button id="buttoncodeheightid" onclick="change_code_height();" style="float:right; width:100px;">100% height</button>
<br/>

<div id="codeid" class = "code_long"><span class="sc9">#include &lt;windows.h&gt;
#include &lt;string&gt;
#include &lt;filesystem&gt;
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">TakeScreenshot</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">wchar_t</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">wPath</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">screenWidth</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetSystemMetrics</span><span class="sc10">(</span><span class="sc11">SM_CXSCREEN</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">screenHeight</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetSystemMetrics</span><span class="sc10">(</span><span class="sc11">SM_CYSCREEN</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">HWND</span><span class="sc0"> </span><span class="sc11">hDesktopWnd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetDesktopWindow</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc11">HDC</span><span class="sc0"> </span><span class="sc11">hDesktopDC</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetDC</span><span class="sc10">(</span><span class="sc11">hDesktopWnd</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">HDC</span><span class="sc0"> </span><span class="sc11">hCaptureDC</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateCompatibleDC</span><span class="sc10">(</span><span class="sc11">hDesktopDC</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">HBITMAP</span><span class="sc0"> </span><span class="sc11">hCaptureBitmap</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateCompatibleBitmap</span><span class="sc10">(</span><span class="sc11">hDesktopDC</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">screenWidth</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">screenHeight</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">BITMAP</span><span class="sc0"> </span><span class="sc11">bmpScreen</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">BITMAPFILEHEADER</span><span class="sc0"> </span><span class="sc11">bmpFHeader</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">BITMAPINFOHEADER</span><span class="sc0"> </span><span class="sc11">bmpIHeader</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwBmpSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwSizeofDIB</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwBytesWritten</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">SelectObject</span><span class="sc10">(</span><span class="sc11">hCaptureDC</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hCaptureBitmap</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">BitBlt</span><span class="sc10">(</span><span class="sc11">hCaptureDC</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">screenWidth</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">screenHeight</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">hDesktopDC</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SRCCOPY</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">CAPTUREBLT</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">GetObjectW</span><span class="sc10">(</span><span class="sc11">hCaptureBitmap</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">BITMAP</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">bmpScreen</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">bmpIHeader</span><span class="sc10">.</span><span class="sc11">biSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">BITMAPINFOHEADER</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">bmpIHeader</span><span class="sc10">.</span><span class="sc11">biWidth</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">bmpScreen</span><span class="sc10">.</span><span class="sc11">bmWidth</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bmpIHeader</span><span class="sc10">.</span><span class="sc11">biHeight</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">bmpScreen</span><span class="sc10">.</span><span class="sc11">bmHeight</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bmpIHeader</span><span class="sc10">.</span><span class="sc11">biPlanes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bmpIHeader</span><span class="sc10">.</span><span class="sc11">biBitCount</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">bmpScreen</span><span class="sc10">.</span><span class="sc11">bmBitsPixel</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bmpIHeader</span><span class="sc10">.</span><span class="sc11">biCompression</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BI_RGB</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bmpIHeader</span><span class="sc10">.</span><span class="sc11">biSizeImage</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bmpIHeader</span><span class="sc10">.</span><span class="sc11">biXPelsPerMeter</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bmpIHeader</span><span class="sc10">.</span><span class="sc11">biYPelsPerMeter</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bmpIHeader</span><span class="sc10">.</span><span class="sc11">biClrUsed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bmpIHeader</span><span class="sc10">.</span><span class="sc11">biClrImportant</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">dwBmpSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">bmpScreen</span><span class="sc10">.</span><span class="sc11">bmWidth</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">bmpIHeader</span><span class="sc10">.</span><span class="sc11">biBitCount</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">31</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">bmpScreen</span><span class="sc10">.</span><span class="sc11">bmHeight</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">lpbitmap</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc11">dwBmpSize</span><span class="sc10">];</span><span class="sc0">

    </span><span class="sc11">GetDIBits</span><span class="sc10">(</span><span class="sc11">hDesktopDC</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hCaptureBitmap</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc10">(</span><span class="sc11">UINT</span><span class="sc10">)</span><span class="sc11">bmpScreen</span><span class="sc10">.</span><span class="sc11">bmHeight</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">lpbitmap</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc10">(</span><span class="sc11">BITMAPINFO</span><span class="sc10">*)&amp;</span><span class="sc11">bmpIHeader</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DIB_RGB_COLORS</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">hFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateFileW</span><span class="sc10">(</span><span class="sc11">wPath</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">GENERIC_WRITE</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">CREATE_ALWAYS</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">dwSizeofDIB</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dwBmpSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DWORD</span><span class="sc10">)</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">BITMAPFILEHEADER</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DWORD</span><span class="sc10">)</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">BITMAPINFOHEADER</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">bmpFHeader</span><span class="sc10">.</span><span class="sc11">bfOffBits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DWORD</span><span class="sc10">)</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">BITMAPFILEHEADER</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DWORD</span><span class="sc10">)</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">BITMAPINFOHEADER</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">bmpFHeader</span><span class="sc10">.</span><span class="sc11">bfSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dwSizeofDIB</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bmpFHeader</span><span class="sc10">.</span><span class="sc11">bfType</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x4D42</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// BM
</span><span class="sc0">
    </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">bmpFHeader</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">BITMAPFILEHEADER</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">dwBytesWritten</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">bmpIHeader</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">BITMAPINFOHEADER</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">dwBytesWritten</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lpbitmap</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">dwBmpSize</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">dwBytesWritten</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">delete</span><span class="sc10">[](</span><span class="sc11">lpbitmap</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">ReleaseDC</span><span class="sc10">(</span><span class="sc11">hDesktopWnd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hDesktopDC</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">DeleteDC</span><span class="sc10">(</span><span class="sc11">hCaptureDC</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">DeleteObject</span><span class="sc10">(</span><span class="sc11">hCaptureBitmap</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">main</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">stat</span><span class="sc0"> </span><span class="sc11">info</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pathname</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"./ScreenshotTaker"</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stat</span><span class="sc10">(</span><span class="sc11">pathname</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">info</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">check</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">filesystem</span><span class="sc10">::</span><span class="sc11">create_directory</span><span class="sc10">(</span><span class="sc11">pathname</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">check</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">ShowWindow</span><span class="sc10">(</span><span class="sc11">GetConsoleWindow</span><span class="sc10">(),</span><span class="sc0"> </span><span class="sc11">SW_HIDE</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">auto</span><span class="sc0"> </span><span class="sc11">now</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">chrono</span><span class="sc10">::</span><span class="sc11">system_clock</span><span class="sc10">::</span><span class="sc11">now</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc16">time_t</span><span class="sc0"> </span><span class="sc11">t_now</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">chrono</span><span class="sc10">::</span><span class="sc11">system_clock</span><span class="sc10">::</span><span class="sc11">to_time_t</span><span class="sc10">(</span><span class="sc11">now</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">time_buffer</span><span class="sc10">[</span><span class="sc4">26</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc2">// can't be less than 26 according to https://en.cppreference.com/w/c/chrono/ctime
</span><span class="sc0">    </span><span class="sc11">ctime_s</span><span class="sc10">(</span><span class="sc11">time_buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">time_buffer</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">t_now</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">sTimeNoColons</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">time_buffer</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">time_buffer</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\n'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">time_buffer</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">':'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">sTimeNoColons</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">time_buffer</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">sTimeNoColons</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc7">'_'</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">wstring</span><span class="sc0"> </span><span class="sc11">wsTimeNoColons</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">L".\\ScreenshotTaker\\"</span><span class="sc0">
        </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">wstring</span><span class="sc10">(</span><span class="sc11">sTimeNoColons</span><span class="sc10">.</span><span class="sc11">begin</span><span class="sc10">(),</span><span class="sc0"> </span><span class="sc11">sTimeNoColons</span><span class="sc10">.</span><span class="sc11">end</span><span class="sc10">())</span><span class="sc0">
        </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">L".bmp"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">wchar_t</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">wcharTimeNoColons</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">wsTimeNoColons</span><span class="sc10">.</span><span class="sc11">c_str</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc11">TakeScreenshot</span><span class="sc10">(</span><span class="sc11">wcharTimeNoColons</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span></div>

&emsp;Starting from main, we check if "ScreenshotTaker" directory exists, if not - we create it using <span class="code_quote">std::filesystem::create_directory()</span> from filesystem header (works from C++17). We can do this also the old way with <span class="code_quote">_mkdir</span> including <span class="code_quote">direct.h</span>.<br/>
After this we ensuring that the console window will not cover the screen, that's why we use <span class="code_quote">ShowWindow(GetConsoleWindow(), SW_HIDE)</span>.<br/>
Next we get currect time as this is how our new BMP file will be named and convert it from timestamp value to readable date with <span class="code_quote">ctime_s()</span> function.
To easily manipulate string data we use <span class="code_quote">std::string</span> variable.
As our times contains colons that are not allowed for filesystem names, we change them to underline char when moving data from buffer to our string.<br/>
Later we will need to pass the full path as wide chars string so we need to do proper conversion to <span class="code_quote">std::wstring</span> and finally to <span class="code_quote">const wchar_t*</span>.<br/>
&emsp;In <span class="code_quote">"TakeScreenshot()"</span> we declare all variables and set or get values right away as mentioned above.<br/>
We do <span class="code_quote">SelectObject()</span> to select obtained earlier bitmap object into DC.
Executing <span class="code_quote">BitBlt()</span> makes bit block transfer of the color data from source DC to destination DC.
With the <span class="code_quote">GetObjectW</span> we retrieve information from our bitmap handle (<span class="code_quote">HBITMAP</span>) to specified <span class="code_quote">BITMAP</span> object. Next we set all the values for <span class="code_quote">BITMAPINFOHEADER</span> and count bitmap size:<br/>
<div class="code_short"><span class="sc11">dwBmpSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">bmpScreen</span><span class="sc10">.</span><span class="sc11">bmWidth</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">bmiHeader</span><span class="sc10">.</span><span class="sc11">biBitCount</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">31</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">bmpScreen</span><span class="sc10">.</span><span class="sc11">bmHeight</span><span class="sc10">;</span></div>
&emsp;To calculate bitmap byte size we need first to know that 32-bit DWORD (see above) is used for storing values in a row and its size must be rounded to DWORD size by padding. We multiply width in pixels by BPP value (32 generally for high quality) and we add 31 (it comes from 32-bit DWORD size minus 1, because we use '/' division operator so round down) to divide it by 32 (bit DWORD size) so we get how many DWORDS are needed for the single row. Finally we need to multiply by 4 (as DWORD is 4 bytes) to get bytes size for the row. In the end we multiply the result with pixel height value.<br/>
&emsp;Next we allocate dynamically char array with calculated size above for our bitmap data and execute <span class="code_quote">GetDIBits()</span> function that retrieves bits from pointed to bitmap and transfers them into the buffer as a DIB.<br/>
&emsp;Finally we get to saving all the data to a file, we use our handle and <span class="code_quote">CreateFileW()</span> function (CreateFileW uses string with UNICODE UTF-16LE chars for path so wchar_t). We count total size of the file so bitmap with its and info headers size what presents together DIB, set the offset value for the pixel array, total size and type. Next we write all three parts of our file in correct order and close the file handle.<br/>
&emsp;In the end we also clean everything up by releasing handles and deleting created objects. Our .bmp file should be saved now under <span style="font-style:italic">./SreenshotTaker/'current date'.bmp"</span> relative to the path where compiled .exe file was launched from.
<!--we transfer the bits from pointed to compatible bitmap and copy them into a buffer as a DIB.-->

</div>
